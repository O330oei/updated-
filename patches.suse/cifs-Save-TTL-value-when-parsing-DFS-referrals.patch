From: Paulo Alcantara <palcantara@suse.de>
Date: Wed, 14 Nov 2018 15:38:51 -0200
Subject: [PATCH] cifs: Save TTL value when parsing DFS referrals
Git-commit: e7b602f43719fc6173ae86d2de8f6f07c6858ddd
Patch-mainline: v5.0-rc1
References: bsc#1144333

This will be needed by DFS cache.

Signed-off-by: Paulo Alcantara <palcantara@suse.de>
Reviewed-by: Aurelien Aptel <aaptel@suse.com>
Signed-off-by: Steve French <stfrench@microsoft.com>
Acked-by: Aurelien Aptel <aaptel@suse.com>
---
 fs/cifs/cifsglob.h | 1 +
 fs/cifs/misc.c     | 2 ++
 2 files changed, 3 insertions(+)

diff --git a/fs/cifs/cifsglob.h b/fs/cifs/cifsglob.h
index 7b3b9313dcde..3b1aa12708a0 100644
--- a/fs/cifs/cifsglob.h
+++ b/fs/cifs/cifsglob.h
@@ -1508,6 +1508,7 @@ struct dfs_info3_param {
 	int ref_flag;
 	char *path_name;
 	char *node_name;
+	int ttl;
 };
 
 /*
diff --git a/fs/cifs/misc.c b/fs/cifs/misc.c
index f7c0c6fde552..5e315e4009e2 100644
--- a/fs/cifs/misc.c
+++ b/fs/cifs/misc.c
@@ -740,6 +740,8 @@ parse_dfs_referrals(struct get_dfs_referral_rsp *rsp, u32 rsp_size,
 			goto parse_DFS_referrals_exit;
 		}
 
+		node->ttl = le32_to_cpu(ref->TimeToLive);
+
 		ref++;
 	}
 
-- 
2.16.4

