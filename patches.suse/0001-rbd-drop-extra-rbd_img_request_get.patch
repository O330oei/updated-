From: Luis Henriques <lhenriques@suse.com>
Date: Fri, 23 Jun 2017 16:21:42 +0100
Subject: rbd: drop extra rbd_img_request_get
Patch-mainline: Never, it fixes SUSE-specific code that has never been
   merged upstream
References: bsc#1045596

Upstream commit 4a17dadcae55 ("rbd: move bumping img_request refcount into
rbd_obj_request_submit()") has modified rbd_obj_request_submit() to do a
get img_request.

This however introduced a regression in function tcm_rbd_execute_cmp_and_write
as it is calling rbd_img_cmp_and_write_request_fill (which does an
rbd_img_request_get()) followed by rbd_img_request_submit, which will
eventually invoke rbd_obj_request_submit.

Signed-off-by: Luis Henriques <lhenriques@suse.com>
Acked-by: David Disseldorp <ddiss@suse.de>
---
 drivers/block/rbd.c |    1 -
 1 file changed, 1 deletion(-)

--- a/drivers/block/rbd.c
+++ b/drivers/block/rbd.c
@@ -2653,7 +2653,6 @@ int rbd_img_cmp_and_write_request_fill(s
 	if (ceph_osdc_alloc_messages(osd_req, GFP_NOIO))
 		goto del_obj_req;
 
-	rbd_img_request_get(img_request);
 	return 0;
 
 del_obj_req:
