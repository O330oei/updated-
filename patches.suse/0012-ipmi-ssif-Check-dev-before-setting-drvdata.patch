From 5afc08d03d350f9014a1c348e42e34f6888514b4 Mon Sep 17 00:00:00 2001
From: Corey Minyard <cminyard@mvista.com>
Date: Wed, 28 Jun 2017 12:44:35 -0500
Subject: [PATCH 12/20] ipmi:ssif: Check dev before setting drvdata

Git-commit: 87ff091c4061eae16c799af51030b539afec97ef
Patch-mainline: v4.13-rc1
References: bsc#1060799

dev can be NULL.

Reported-by: Austin Christ <austinwc@codeaurora.org>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Mian Yousaf Kaukab <yousaf.kaukab@suse.com>
---
 drivers/char/ipmi/ipmi_ssif.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/char/ipmi/ipmi_ssif.c b/drivers/char/ipmi/ipmi_ssif.c
index fa9cbcbdf73a..0aea3bcb6158 100644
--- a/drivers/char/ipmi/ipmi_ssif.c
+++ b/drivers/char/ipmi/ipmi_ssif.c
@@ -1782,7 +1782,8 @@ static int new_ssif_client(int addr, char *adapter_name,
 	addr_info->addr_src = addr_src;
 	addr_info->dev = dev;
 
-	dev_set_drvdata(dev, addr_info);
+	if (dev)
+		dev_set_drvdata(dev, addr_info);
 
 	list_add_tail(&addr_info->link, &ssif_infos);
 
-- 
2.11.0

